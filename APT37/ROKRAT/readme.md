  # ROKRAT (Windows) PS Decoder
This is a simple script to quickly decode the Powershell encoded command contained within payload delivery files. Most recently these are seen in the form of LNK documents. When receiving a sample, I am often aware of the time sensitivity of payload delivery host shutting down, and because I want to encoded shellcode payload quickly, I created this script. 

It will assist with the following steps when analysing ROKRAT samples:

 - User extracts encoded command (i.e running strings against LNK document) 
<img width="626" alt="image" src="https://github.com/0x0v1/MalwareRETools/assets/137784219/324cf6e2-eb4d-4f90-b477-47228f930e40">
 
 - User extract encoded portion of the command
 - User runs this script and inputs the encoded command
 - Script will decode the command showing the reflective powershell injection
 - Script will extract payload delivery host
 - Script will give the user the option to request the payload delivery host and pull the payload, it will zip the payload the the cwd with the password infected (ensure you are doing this is a lab environment. I don't accept responsibility for you pulling malware yourself etc.) 

<img width="937" alt="image" src="https://github.com/0x0v1/MalwareRETools/assets/137784219/79249092-a976-42fd-88d4-37905d2bb794">

  # ROKRAT (Windows) Shellcode DeEncryptor

In the latest versions of ROKRAT, the loader will reach out to OneDrive or another cloud provider and pull shellcode into another binary using reflective PS injection. The shellcode is typically encrypted.

<img width="440" alt="image" src="https://github.com/0x0v1/MalwareRETools/assets/137784219/e87da8da-841e-4dd7-91ae-f31c92af3afd">

The ROKRAT loader will decrypt this on the fly and load into binary, but if you are a researcher have pulled the shellcode manually or programmatically (like the PS Decoder script in this repo) you may be left with an encoded shellcode blob. Running this script will perform the decryption the shellcode using the first byte as a key and XORing it with the remainder of the payload

<img width="344" alt="image" src="https://github.com/0x0v1/MalwareRETools/assets/137784219/8a2cd274-51b2-4794-9f52-d4e52fcf3dce">

The result will give you the shellcode ready for analysis

![image](https://github.com/0x0v1/MalwareRETools/assets/137784219/57b0fd0b-d932-4097-9118-7105a900814c)


